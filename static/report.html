<head>
    <script src="https://cdn.plot.ly/plotly-2.16.1.min.js"></script>
    <script src="https://d3js.org/d3.v7.min.js"></script>
    <script src="/static/report.js"></script>
    <link rel="stylesheet" href="report.css"/>
</head>
<html>
    <input type="text" id="name-input"/>
    <div id="irating-history-per-race-d3js"></div>
    <div id="track-usage-d3js"></div>
    <div id="irating-history-per-date" style="width:800px;height:450px;"></div>
    <div id="irating-history-per-race" style="width:800px;height:450px;"></div>
    <div id="car-track-time-stats"/>
    <div id="car-track-laps-stats"/>
    <div id="car-time-stack-stats"/>
    <div id="track-time-stack-stats"/>
    <script>
        nameInput = document.getElementById("name-input");
        iratingHistoryDateD3JSDiv = document.getElementById('irating-history-per-race-d3js');
        trackUsageD3JSDiv = document.getElementById('irating-history-per-race-d3js');
        iratingHistoryDateDiv = document.getElementById('irating-history-per-date');
        iratingHistoryRaceDiv = document.getElementById('irating-history-per-race');
        carTrackTimeStatsDiv = document.getElementById('car-track-time-stats');
        carTrackLapsStatsDiv = document.getElementById('car-track-laps-stats');
        carTimeStackStatsDiv = document.getElementById('car-time-stack-stats');
        trackTimeStackStatsDiv = document.getElementById('track-time-stack-stats');

        let paramString = window.location.search.split('?')[1];
        let queryString = new URLSearchParams(paramString);

        let urlDriver = queryString.get('driver');
        let urlCategory = queryString.get('category') || "";
        if (urlDriver) {
            nameInput.value = urlDriver;
            updateDriver(urlDriver, urlCategory);
        }

        function updateDriver(name, category) {
            if (!name) {
                console.log("Empty name");
                return;
            }

            updateIratingHistory(iratingHistoryDateDiv, iratingHistoryRaceDiv, iratingHistoryDateD3JSDiv, name, category);
            updateTrackUsage(trackUsageD3JSDiv, name, category);
            // updateCarTrackUsageStats(
            //     carTrackTimeStatsDiv, carTrackLapsStatsDiv,
            //     carTimeStackStatsDiv, trackTimeStackStatsDiv,
            //     name
            // );
        }

        nameInput.onkeypress = function(ev) {
            if (ev.keyCode == 13) { // enter
                updateDriver(nameInput.value);
            }
        }
    </script>
</html>
