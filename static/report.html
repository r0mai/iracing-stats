<head>
    <script src="https://cdn.plot.ly/plotly-2.16.1.min.js"></script>
    <script src="https://d3js.org/d3.v7.min.js"></script>
    <script src="/static/plot.js"></script>
    <script src="/static/report.js"></script>
    <link rel="stylesheet" href="report.css"/>
</head>
<html>
    <input type="text" id="name-input"/>
    <div id="driver-stats">
        <table class="driver-stats-table">
            <tbody>
                <tr>
                    <td>Name:</td>
                    <td id="driver-name-value"></td>
                </tr>
                <tr>
                    <td>Total laps:</td>
                    <td id="total-laps-value"></td>
                </tr>
                <tr>
                    <td>Total time:</td>
                    <td id="total-time-value"></td>
                </tr>
                <tr>
                    <td>Total distance:</td>
                    <td id="total-distance-value"></td>
                </tr>
            </tbody>
        </table>
    </div>
    <div id="irating-history-per-race-d3js"></div>
    <div id="track-usage-time-d3js"></div>
    <div id="track-usage-laps-d3js"></div>
    <div id="track-usage-distance-d3js"></div>
    <div id="car-usage-time-d3js"></div>
    <div id="car-usage-distance-d3js"></div>
    <div id="irating-history-per-date" style="width:800px;height:450px;"></div>
    <div id="irating-history-per-race" style="width:800px;height:450px;"></div>
    <div id="car-track-time-stats"/>
    <div id="car-track-laps-stats"/>
    <div id="car-time-stack-stats"/>
    <div id="track-time-stack-stats"/>
    <script>
        nameInput = document.getElementById("name-input");
        driverStatsDiv = document.getElementById("driver-stats");
        iratingHistoryDateD3JSDiv = document.getElementById('irating-history-per-race-d3js');
        trackUsageTimeD3JSDiv = document.getElementById('track-usage-time-d3js');
        trackUsageLapsD3JSDiv = document.getElementById('track-usage-laps-d3js');
        trackUsageDistanceD3JSDiv = document.getElementById('track-usage-distance-d3js');
        carUsageTimeD3JSDiv = document.getElementById('car-usage-time-d3js');
        carUsageDistanceD3JSDiv = document.getElementById('car-usage-distance-d3js');
        iratingHistoryDateDiv = document.getElementById('irating-history-per-date');
        iratingHistoryRaceDiv = document.getElementById('irating-history-per-race');
        carTrackTimeStatsDiv = document.getElementById('car-track-time-stats');
        carTrackLapsStatsDiv = document.getElementById('car-track-laps-stats');
        carTimeStackStatsDiv = document.getElementById('car-time-stack-stats');
        trackTimeStackStatsDiv = document.getElementById('track-time-stack-stats');

        let paramString = window.location.search.split('?')[1];
        let queryString = new URLSearchParams(paramString);

        let urlDriver = queryString.get('driver');
        let urlCategory = queryString.get('category') || "";
        if (urlDriver) {
            nameInput.value = urlDriver;
            updateDriver(urlDriver, urlCategory);
        }

        function updateDriver(name, category) {
            if (!name) {
                console.log("Empty name");
                return;
            }

            updateIratingHistory(iratingHistoryDateDiv, iratingHistoryRaceDiv, iratingHistoryDateD3JSDiv, name, category);
            updateTrackUsage(trackUsageTimeD3JSDiv, trackUsageLapsD3JSDiv, trackUsageDistanceD3JSDiv, name, category);
            updateCarUsage(carUsageTimeD3JSDiv, carUsageDistanceD3JSDiv, name, category);
            updateCarTrackUsageStats(
                carTrackTimeStatsDiv, carTrackLapsStatsDiv,
                carTimeStackStatsDiv, trackTimeStackStatsDiv,
                name
            );
            updateDriverStats(driverStatsDiv, name);
        }

        nameInput.onkeypress = function(ev) {
            if (ev.keyCode == 13) { // enter
                updateDriver(nameInput.value);
            }
        }
    </script>
</html>
